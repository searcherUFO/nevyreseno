<!doctype html>
<html lang="cs">
<head>
    <meta charset="utf-8">
    <title>ETH Safe-Turbo 100/s</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #0d1117; color: #c9d1d9; font-family: 'Consolas', monospace; }
        .main-card { background-color: #161b22; border: 1px solid #30363d; border-radius: 12px; padding: 25px; }
        textarea { background-color: #010409 !important; color: #58a6ff !important; border: 1px solid #30363d !important; height: 250px; font-size: 12px; }
        .eth-green { color: #2ecc71; font-weight: bold; }
        .eth-zero { color: #484f58; }
        .total-box { background: #010409; border: 2px solid #58a6ff; border-radius: 8px; padding: 15px; text-align: center; }
        .progress { height: 4px; background-color: #30363d; margin-top: 10px; }
        .progress-bar { background-color: #58a6ff; transition: width 0.2s; }
        .log-container { height: 300px; overflow-y: auto; background: #010409; padding: 10px; border-radius: 8px; border: 1px solid #30363d; font-size: 11px; }
    </style>
</head>
<body>

<div class="container py-4">
    <div class="main-card shadow-lg mb-4">
        <div class="row align-items-center mb-4">
            <div class="col-md-7">
                <h2 class="fw-bold mb-0">ETH <span style="color:#58a6ff">True</span>-Scanner</h2>
                <div id="status" class="small text-muted mt-1">Status: Připraven</div>
            </div>
            <div class="col-md-5">
                <div class="total-box">
                    <small class="text-muted fw-bold">CELKOVÝ ZŮSTATEK</small>
                    <div class="h2 mb-0 text-white"><span id="totalEth" style="color:#2ecc71">0.0000</span> ETH</div>
                </div>
            </div>
        </div>

        <textarea id="addressInput" class="form-control" placeholder="Vložte adresy (0x...)"></textarea>
        <div class="progress"><div id="progressBar" class="progress-bar" style="width: 0%"></div></div>

        <button id="runBtn" class="btn btn-primary w-100 fw-bold mt-4 py-2" onclick="startCheck()">SPUSTIT SPOLEHLIVÝ SKEN</button>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between small mb-2 text-muted fw-bold text-uppercase">
                <span>Průběh skenování</span>
                <span>Nalezeno s obnosem: <span id="positiveCount" class="text-success">0</span></span>
            </div>
            <div id="log" class="log-container"></div>
        </div>
    </div>
</div>

<script>
const RPC_URL = "https://eth-mainnet.g.alchemy.com/v2/Aez99WycUrG8jncryndbA";

async function startCheck() {
    const input = document.getElementById('addressInput').value;
    const addresses = input.split('\n').map(a => a.trim().toLowerCase()).filter(a => a.startsWith('0x') && a.length === 42);
    
    if (addresses.length === 0) return alert("Vložte platné ETH adresy!");

    const btn = document.getElementById('runBtn');
    const status = document.getElementById('status');
    const logBox = document.getElementById('log');
    const totalDisp = document.getElementById('totalEth');
    const pBar = document.getElementById('progressBar');
    const posDisp = document.getElementById('positiveCount');

    btn.disabled = true;
    logBox.innerHTML = '';
    let totalWei = BigInt(0);
    let positiveFound = 0;
    
    // NASTAVENÍ: 25 adres na balík (pro maximální úspěšnost u Alchemy)
    const BATCH_SIZE = 25; 

    for (let i = 0; i < addresses.length; i += BATCH_SIZE) {
        const chunk = addresses.slice(i, i + BATCH_SIZE);
        status.innerText = `Skenuji: ${i + 1} - ${Math.min(i + BATCH_SIZE, addresses.length)} / ${addresses.length}`;

        let data = null;
        let attempt = 0;

        // Mechanismus "Nikdy se nevzdávej" - zkusí balík až 3x
        while (attempt < 3) {
            try {
                const body = chunk.map((addr, idx) => ({
                    jsonrpc: "2.0", id: i + idx, method: "eth_getBalance", params: [addr, "latest"]
                }));

                const res = await fetch(RPC_URL, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body)
                });

                if (res.status === 429) throw new Error("Rate Limit");

                data = await res.json();
                if (Array.isArray(data)) break; // Úspěch
            } catch (e) {
                attempt++;
                status.innerText = `Alchemy nestíhá, čekám a zkouším znovu (${attempt}/3)...`;
                await new Promise(r => setTimeout(r, 1000 * attempt));
            }
        }

        if (data && Array.isArray(data)) {
            let logHtml = "";
            data.forEach((res, idx) => {
                const addr = chunk[idx];
                let displayBal = "0.00";
                let styleStr = "eth-zero";

                if (res.result) {
                    const wei = BigInt(res.result);
                    if (wei > 0n) {
                        totalWei += wei;
                        positiveFound++;
                        displayBal = (Number(wei) / 1e18).toFixed(6);
                        styleStr = "eth-green";
                    }
                }

                logHtml += `<div class="d-flex justify-content-between border-bottom border-dark py-1">
                    <span class="text-muted">${addr}</span>
                    <span class="${styleStr}">${displayBal} ETH</span>
                </div>`;
            });
            
            logBox.insertAdjacentHTML('afterbegin', logHtml);
            totalDisp.innerText = (Number(totalWei) / 1e18).toFixed(4);
            posDisp.innerText = positiveFound;
        }

        // Progress bar a malá pauza
        pBar.style.width = `${(Math.min(i + BATCH_SIZE, addresses.length) / addresses.length) * 100}%`;
        await new Promise(r => setTimeout(r, 150)); // Stabilizační pauza
    }

    status.innerText = "HOTOVO!";
    btn.disabled = false;
}
</script>
</body>
</html>
