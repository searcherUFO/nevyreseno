<!doctype html>
<html lang="cs">
<head>
    <meta charset="utf-8">
    <title>ETH Checker Fix</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #0f111a; color: #e0e0e0; font-family: 'Segoe UI', sans-serif; }
        .card-custom { background-color: #1a1c2e; border: 1px solid #2d2f4d; border-radius: 15px; padding: 25px; }
        textarea { background-color: #0a0b14 !important; color: #00d4ff !important; border: 1px solid #3d4063 !important; font-family: 'Courier New', monospace; height: 250px; }
        .eth-color { color: #627eea; }
        .balance-val { color: #00ff88; font-weight: bold; text-align: right; }
        .status-msg { font-size: 0.85em; color: #8b949e; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <h2 class="text-center mb-4 fw-bold text-uppercase tracking-widest"><span class="eth-color">ETH</span> Balance Tracker</h2>

            <div class="card-custom mb-4 shadow-lg">
                <div class="mb-3">
                    <label class="form-label small fw-bold">1. RPC ADRESA (Zadej svůj Alchemy ETH link pro max. rychlost)</label>
                    <input type="text" id="rpcUrl" class="form-control bg-dark text-white border-secondary" 
                        value="https://eth.llamarpc.com">
                    <div class="form-text text-muted">Výchozí: LlamaRPC (funkční veřejná brána).</div>
                </div>

                <div class="mb-3">
                    <label class="form-label small fw-bold">2. ETH ADRESY (např. 0x71C...)</label>
                    <textarea id="addressInput" class="form-control" placeholder="0x..."></textarea>
                </div>

                <button id="runBtn" class="btn btn-primary w-100 fw-bold py-3" onclick="checkEth()">SKEΝOVAT ADRESY</button>
                <div id="statusInfo" class="status-msg text-center"></div>
            </div>

            <div id="resultsArea" class="d-none">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="mb-0">Výsledky</h4>
                    <div class="text-end">
                        <small class="text-muted">CELKEM:</small>
                        <h2 class="eth-color mb-0"><span id="totalEth">0.0000</span> ETH</h2>
                    </div>
                </div>
                <div class="card-custom p-0 overflow-hidden border-0">
                    <table class="table table-dark table-striped mb-0">
                        <thead>
                            <tr>
                                <th class="ps-4">Adresa</th>
                                <th class="text-end pe-4">Zůstatek</th>
                            </tr>
                        </thead>
                        <tbody id="resultBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
async function checkEth() {
    const rpcUrl = document.getElementById('rpcUrl').value.trim();
    const input = document.getElementById('addressInput').value;
    // Očistíme adresy - musí začínat 0x a mít správnou délku
    const addresses = input.split('\n')
        .map(a => a.trim().toLowerCase())
        .filter(a => a.startsWith('0x') && a.length === 42);

    if (addresses.length === 0) return alert("Vložte platné ETH adresy začínající 0x (délka 42 znaků)!");

    const btn = document.getElementById('runBtn');
    const list = document.getElementById('resultBody');
    const totalDisp = document.getElementById('totalEth');
    const status = document.getElementById('statusInfo');
    
    btn.disabled = true;
    document.getElementById('resultsArea').classList.remove('d-none');
    list.innerHTML = '';
    let totalWei = BigInt(0);

    for (let i = 0; i < addresses.length; i++) {
        const addr = addresses[i];
        status.innerText = `Kontroluji ${i + 1} z ${addresses.length}...`;

        try {
            const response = await fetch(rpcUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    jsonrpc: "2.0",
                    id: i,
                    method: "eth_getBalance",
                    params: [addr, "latest"]
                })
            });

            const data = await response.json();

            if (data.result) {
                const wei = BigInt(data.result);
                totalWei += wei;
                const ethVal = (Number(wei) / 1e18).toFixed(6);

                list.insertAdjacentHTML('beforeend', `
                    <tr>
                        <td class="ps-4 font-monospace"><small>${addr}</small></td>
                        <td class="text-end pe-4 balance-val">${ethVal} ETH</td>
                    </tr>
                `);
                totalDisp.innerText = (Number(totalWei) / 1e18).toFixed(6);
            } else {
                throw new Error("Neplatný výsledek");
            }

        } catch (e) {
            console.error("Chyba:", e);
            list.insertAdjacentHTML('beforeend', `<tr><td class="ps-4 text-danger">${addr}</td><td class="text-end pe-4 text-danger">Error</td></tr>`);
        }

        // Malá pauza proti zablokování (u Alchemy můžeš nastavit na 0)
        await new Promise(r => setTimeout(r, 200));
    }

    status.innerText = "Hotovo.";
    btn.disabled = false;
}
</script>
</body>
</html>
