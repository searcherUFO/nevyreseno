<!doctype html>
<html lang="cs">
<head>
    <meta charset="utf-8">
    <title>ETH Extreme Speed</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #06090f; color: #c9d1d9; font-family: 'Inter', sans-serif; }
        .card-custom { background-color: #0d1117; border: 1px solid #30363d; border-radius: 12px; padding: 25px; }
        textarea { background-color: #010409 !important; color: #58a6ff !important; border: 1px solid #30363d !important; font-family: 'Courier New', monospace; height: 300px; font-size: 13px; }
        .eth-blue { color: #1f6feb; font-weight: bold; }
        .total-number { font-size: 2.5rem; color: #238636; text-shadow: 0 0 10px rgba(35, 134, 54, 0.3); }
        .speed-indicator { color: #f7931a; font-size: 0.8rem; font-weight: bold; }
    </style>
</head>
<body>

<div class="container py-5">
    <div class="card-custom shadow-lg">
        <div class="row align-items-center mb-4">
            <div class="col-md-6">
                <h2 class="mb-0">ETH <span class="eth-blue">Extreme</span> Speed</h2>
                <div id="statusInfo" class="speed-indicator mt-1">PŘIPRAVENO K BLESKOVÉMU SKENU</div>
            </div>
            <div class="col-md-6 text-end">
                <div class="small text-muted fw-bold">CELKOVÝ ZŮSTATEK</div>
                <div class="total-number"><span id="totalEth">0.000000</span> <small style="font-size: 1rem">ETH</small></div>
            </div>
        </div>

        <textarea id="addressInput" class="form-control mb-4" placeholder="Vlož tisíce adres pro okamžitou kontrolu..."></textarea>

        <button id="runBtn" class="btn btn-primary w-100 py-3 fw-bold shadow" onclick="processExtreme()">
            SPUSTIT EXTRÉMNÍ SKEN (3 PARALELNÍ VLÁKNA)
        </button>
    </div>

    <div id="resultsArea" class="d-none mt-4">
        <div class="table-responsive">
            <table class="table table-dark table-hover border-secondary">
                <tbody id="resultBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
const ALCHEMY_URL = "https://eth-mainnet.g.alchemy.com/v2/Aez99WycUrG8jncryndbA";

async function processExtreme() {
    const input = document.getElementById('addressInput').value;
    const addresses = input.split('\n')
        .map(a => a.trim().toLowerCase())
        .filter(a => a.startsWith('0x') && a.length === 42);

    if (addresses.length === 0) return alert("Vložte ETH adresy!");

    const btn = document.getElementById('runBtn');
    const list = document.getElementById('resultBody');
    const totalDisp = document.getElementById('totalEth');
    const status = document.getElementById('statusInfo');
    
    // UI Setup
    btn.disabled = true;
    document.getElementById('resultsArea').classList.remove('d-none');
    list.innerHTML = '';
    let totalWei = BigInt(0);
    const startTime = performance.now();

    // NASTAVENÍ RYCHLOSTI
    const BATCH_SIZE = 150; // Velikost jedné dávky
    const PARALLEL_THREADS = 3; // Kolik dávek se posílá najednou

    // Rozdělení adres do dávek
    const chunks = [];
    for (let i = 0; i < addresses.length; i += BATCH_SIZE) {
        chunks.push(addresses.slice(i, i + BATCH_SIZE));
    }

    let completedChunks = 0;

    // Funkce pošle jednu dávku
    const sendBatch = async (chunk, chunkIndex) => {
        const payload = chunk.map((addr, idx) => ({
            jsonrpc: "2.0",
            id: chunkIndex * BATCH_SIZE + idx,
            method: "eth_getBalance",
            params: [addr, "latest"]
        }));

        try {
            const response = await fetch(ALCHEMY_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const data = await response.json();
            
            let htmlBatch = "";
            data.forEach((res, idx) => {
                if (res.result) {
                    const wei = BigInt(res.result);
                    totalWei += wei;
                    const eth = (Number(wei) / 1e18).toFixed(6);
                    htmlBatch += `<tr class="border-secondary"><td class="small font-monospace ps-3 text-muted">${chunk[idx]}</td><td class="text-end pe-4 fw-bold text-success">${eth} ETH</td></tr>`;
                }
            });

            list.insertAdjacentHTML('beforeend', htmlBatch);
            totalDisp.innerText = (Number(totalWei) / 1e18).toFixed(6);
            
            completedChunks++;
            status.innerText = `RYCHLOST: PROBÍHÁ PARALELNÍ DOTAZ (${completedChunks} z ${chunks.length} dávek hotovo)`;

        } catch (e) {
            console.error(e);
        }
    };

    // PARALELNÍ SPOUŠTĚNÍ
    // Místo čekání na každou dávku, spustíme několik vln najednou
    for (let i = 0; i < chunks.length; i += PARALLEL_THREADS) {
        const pool = [];
        for (let j = 0; j < PARALLEL_THREADS && (i + j) < chunks.length; j++) {
            pool.push(sendBatch(chunks[i + j], i + j));
        }
        await Promise.all(pool); // Čekáme jen na dokončení aktuální vlny 3 dotazů
    }

    const duration = ((performance.now() - startTime) / 1000).toFixed(2);
    status.innerHTML = `<span class="text-success">✔ HOTOVO! ${addresses.length} ADRES ZA ${duration} s.</span>`;
    btn.disabled = false;
}
</script>
</body>
</html>
