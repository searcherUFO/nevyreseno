<!doctype html>
<html lang="cs">
<head>
    <meta charset="utf-8">
    <title>ETH Multi-Engine 200/s</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #06070a; color: #e1e1e1; font-family: 'Consolas', monospace; }
        .engine-card { background: #11141b; border: 1px solid #2d333b; border-radius: 8px; padding: 20px; }
        textarea { background: #010409 !important; color: #58a6ff !important; border: 1px solid #30363d !important; height: 350px; font-size: 12px; }
        .total-display { font-size: 3rem; color: #2ecc71; font-weight: bold; text-shadow: 0 0 20px rgba(46, 204, 113, 0.4); }
    </style>
</head>
<body>

<div class="container py-4">
    <div class="engine-card shadow-lg">
        <div class="row align-items-center">
            <div class="col-md-7">
                <h1 class="fw-bold mb-0">ETH <span class="text-primary">ULTRA</span> SCANNER</h1>
                <p class="text-muted small">Multi-Provider Parallel Engine (Target: 200+ addr/s)</p>
            </div>
            <div class="col-md-5 text-end border-start border-secondary">
                <div id="totalEth" class="total-display">0.0000</div>
                <div class="small fw-bold text-muted">CELKEM ETH</div>
            </div>
        </div>

        <textarea id="addressInput" class="form-control my-4" placeholder="Vložte tisíce adres (0x...)..."></textarea>

        <button id="runBtn" class="btn btn-primary btn-lg w-100 fw-bold" onclick="launchTurbo()">SPUSTIT PARALELNÍ SKEN</button>
        <div id="stats" class="text-center mt-3 text-info small"></div>
    </div>

    <div id="resultsArea" class="mt-4 d-none">
        <div class="table-responsive"><table class="table table-dark table-sm"><tbody id="resultBody"></tbody></table></div>
    </div>
</div>

<script>
// Seznam RPC, které budeme používat paralelně pro maximální propustnost
const ENGINES = [
    "https://eth-mainnet.g.alchemy.com/v2/Aez99WycUrG8jncryndbA",
    "https://eth.llamarpc.com",
    "https://rpc.ankr.com/eth",
    "https://cloudflare-eth.com",
    "https://1rpc.io/eth"
];

async function launchTurbo() {
    const input = document.getElementById('addressInput').value;
    const addresses = input.split('\n').map(a => a.trim().toLowerCase()).filter(a => a.startsWith('0x') && a.length === 42);
    if (!addresses.length) return alert("Vložte adresy!");

    const btn = document.getElementById('runBtn');
    const status = document.getElementById('stats');
    const totalDisp = document.getElementById('totalEth');
    const list = document.getElementById('resultBody');

    btn.disabled = true;
    list.innerHTML = '';
    let totalWei = BigInt(0);
    const start = performance.now();

    // Nastavení: 40 adres na balík, 5 balíků paralelně = 200 adres v jedné vlně
    const BATCH_SIZE = 40;
    const chunks = [];
    for (let i = 0; i < addresses.length; i += BATCH_SIZE) {
        chunks.push(addresses.slice(i, i + BATCH_SIZE));
    }

    // Paralelní zpracování
    for (let i = 0; i < chunks.length; i += ENGINES.length) {
        const wave = [];
        for (let j = 0; j < ENGINES.length && (i + j) < chunks.length; j++) {
            wave.push(fetchBatch(chunks[i + j], ENGINES[j], i + j));
        }

        const waveResults = await Promise.all(wave);
        
        waveResults.forEach(data => {
            if (!data) return;
            data.results.forEach((res, idx) => {
                if (res.result) {
                    const wei = BigInt(res.result);
                    totalWei += wei;
                    if (wei > 0n) {
                        const eth = (Number(wei) / 1e18).toFixed(6);
                        list.insertAdjacentHTML('afterbegin', `<tr><td class="small text-muted">${data.chunk[idx]}</td><td class="text-end text-success fw-bold">${eth} ETH</td></tr>`);
                    }
                }
            });
        });

        totalDisp.innerText = (Number(totalWei) / 1e18).toFixed(4);
        status.innerText = `Průběh: ${Math.min(i + ENGINES.length * BATCH_SIZE, addresses.length)} / ${addresses.length}`;
        document.getElementById('resultsArea').classList.remove('d-none');
    }

    const duration = ((performance.now() - start) / 1000).toFixed(2);
    status.innerHTML = `<span class="text-success">DOKONČENO: ${addresses.length} adres za ${duration}s (Rychlost: ${Math.round(addresses.length/duration)} addr/s)</span>`;
    btn.disabled = false;
}

async function fetchBatch(chunk, url, id) {
    try {
        const payload = chunk.map((addr, idx) => ({
            jsonrpc: "2.0", id: id + idx, method: "eth_getBalance", params: [addr, "latest"]
        }));

        const res = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
        const results = await res.json();
        return { results, chunk };
    } catch (e) {
        return null;
    }
}
</script>
</body>
</html>
